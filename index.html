<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Planetas AR</title>
  <link rel="stylesheet" href="./styles.css" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <model-viewer id="viewer"
    ar ar-modes="webxr scene-viewer quick-look"
    camera-controls
    auto-rotate auto-rotate-delay="0"
    environment-image="neutral"
    exposure="1.5"
    skybox-image="./assets/stars.jpg">
  </model-viewer>
  <button id="bg-toggle">Fundo: Estrelas</button>
  <script type="module">
    const params = new URLSearchParams(location.search);
    const key = (params.get('planet') || 'marte').toLowerCase();
    const viewer = document.getElementById('viewer');
    fetch('./planets.json').then(r=>r.json()).then(data=>{
      const cfg = data[key] || data['marte'];
      viewer.src = cfg.glb.startsWith('/')? cfg.glb : ('./'+cfg.glb.replace(/^\/?/,''));
      viewer.setAttribute('ios-src', cfg.usdz.startsWith('/')? cfg.usdz : ('./'+cfg.usdz.replace(/^\/?/,'')));
      const s = cfg.scale || 1.4; viewer.setAttribute('scale', `${s} ${s} ${s}`);
    });
    // Toggle skybox/lighting
    let mode=0; const btn = document.getElementById('bg-toggle');
    function apply(){
      if(mode===0){viewer.setAttribute('skybox-image','./assets/stars.jpg');viewer.setAttribute('environment-image','neutral');viewer.setAttribute('exposure','1.5');btn.textContent='Fundo: Estrelas'}
      else if(mode===1){viewer.removeAttribute('skybox-image');viewer.setAttribute('environment-image','neutral');viewer.setAttribute('exposure','1.5');btn.textContent='Fundo: Preto'}
      else{viewer.setAttribute('skybox-image','./assets/stars.jpg');viewer.setAttribute('environment-image','./assets/stars.jpg');viewer.setAttribute('exposure','1.8');btn.textContent='Fundo: Estrelas (Brilho)'}
    }
    btn.addEventListener('click',()=>{mode=(mode+1)%3;apply()}); apply();
  </script>
</body>
</html>
