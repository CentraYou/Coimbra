<!doctype html>
<html lang="pt"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Planetas AR</title>
<link rel="stylesheet" href="/styles.css"/>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head><body>
<header>
  <img alt="Logo" src="https://www.forum-coimbra.com/wp-content/uploads/sites/23/2024/09/header-logo-1-1.png" onerror="this.src='/assets/logo.png'" style="height:28px;object-fit:contain"/>
  <strong id="title">AR</strong>
</header>

<model-viewer id="viewer" ar camera-controls interaction-prompt="auto"
  auto-rotate auto-rotate-delay="0"
  shadow-intensity="0" exposure="1.9"
  environment-image="neutral"
  style="--poster-color: transparent;">
</model-viewer>

<div class="bar">
  <button class="primary" id="btn-ar">Ativar AR</button>
  <button id="btn-center">Recentra</button>
</div>

<script type="module">
const params = new URLSearchParams(location.search);
const key = (params.get("planet") || "marte").toLowerCase();
const viewer = document.getElementById("viewer");
const title = document.getElementById("title");

(async () => {
  const res = await fetch("/planets.json"); const dataMap = await res.json();
  const data = dataMap[key] || dataMap["marte"];
  title.textContent = data.name || "AR";

  // choose src + AR modes + placement
  const src = (key === "livro") ? (data.glb + '?v=13c') : data.glb;
  viewer.src = src;
  if (data.usdz) viewer.setAttribute("ios-src", data.usdz);
  viewer.setAttribute("ar-modes", key === "livro" ? "webxr quick-look" : "webxr scene-viewer quick-look");
  viewer.setAttribute("ar-placement", key === "livro" ? "wall" : "floor");

  const s = data.scale || 1.2;
  viewer.setAttribute("scale", `${s} ${s} ${s}`);

  document.getElementById("btn-ar").onclick = () => viewer.activateAR();
  document.getElementById("btn-center").onclick = () => viewer.resetTurntableRotation();
})();
</script>
</body></html>